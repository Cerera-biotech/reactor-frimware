<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <style>
        #list {
            width: 100%;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 25px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #04AA6D;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #04AA6D;
            cursor: pointer;
        }


        .slider_value {
            display: inline-block;
            position: relative;
            width: 3em;
            /* color: white; */
            line-height: 20px;
            text-align: center;
            border-radius: 3px;
            background: 04AA6D;
            padding: 5px 10px;
            margin-left: 8px;
        }

        .slider_value {
            width: 6%;
        }

        .channel_row {
            width: 6%;
        }

        .slider_row {
            width: 88%;
        }

    </style>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>

<body>

    <h1>Cerera lamp</h1>
    <table id="list">
    </table>
</body>


<script>
    function httpReq(method, theUrl) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open(method, theUrl, false); // false for synchronous request
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }

    let channelsData = JSON.parse(httpReq("GET", `/channels`));

    for (let i = 0; i < channelsData.length; i++) {
        var table = document.getElementById("list");

        var tr = document.createElement("tr");
        tr.className = "slidecontainer"

        let td1 = document.createElement("td")
        td1.className = "channel_row"
        td1.appendChild(document.createTextNode(`channel ${i + 1}`))

        let percent = channelsData[i].duty; //get it from board with html request

        let td3 = document.createElement("td")
        td3.className = "slider_value";
        td3.appendChild(document.createTextNode(percent))


        let td2 = document.createElement("td")
        td2.className = "slider_row"
        let input = document.createElement("input");
        input.type = "range";
        input.min = "0";
        input.max = "1023";
        input.value = percent;
        input.className = "slider";
        input.id = `channel-${i + 1}`;
        input.oninput = function (e) {
            td3.textContent = e.target.value
        }
        input.onchange = function (e) {
            httpReq("PUT", `/channels?channel=${i}&duty=${e.target.value}`)
        }

        td2.appendChild(input)
     
        tr.appendChild(td1);
        tr.appendChild(td2);
        tr.appendChild(td3);
        table.appendChild(tr);
    }
</script>

</html>